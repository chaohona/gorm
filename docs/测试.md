#测试环境说明
MySQL：5.7 <br/>
机器：2.7G HZ，40核，128G <br/>
	Intel(R) Xeon(R) CPU E5-2660 v3 @ 2.60GHz <br/>

## 一、性能(库中没有数据或者是简单的数据，纯粹为了测试MySQL驱动，拿到一个上限数据)
### 1、接入层
10万QPS <br/>
### 2、DB操作层(MySQL和GORM在同一台机器，"select ptr from user_2")
下面每个线程20个连接，请求的表为空，单纯为了测试MySQL的驱动性能 <br/>
|			|1个工作线程|2个工作|3个工作线程|4个工作线程|
|mysql消耗	|500%		|800%	|1000%		|1000%		|
|GORM消耗	|100%		|180%	|280%		|300%		|
|QPS		|2.2万		|5万	|6万		|7万		|

***结论:***<br/>
单MySQL客户端进程最多能跑出7万QPS <br/>

### 3、GORM性能
下面每个线程20个连接，表中数据不多45万条，每次取一条数据或者取不到数据 <br/>
> 1操作线程 1.9万QPS mysql:276%, GORM:160% <br/>
> 2操作线程 2.4万QPS mysql:350%, GORM:270%	由于mysql响应变慢,和单线程相比性能提高不明显 <br/>
***结论:***<br/>
GORM不带缓存功能上限为2万QPS <br/>


## 二、线上数据测试
***测试数据说明***<br/>
征途线上charbase表测试征途线上charbase表测试,400万条数据一张表，每行有185个字段，每行数据大小从300字节到10K+字节，可以认为是线上一个区的数据 <br/>

***测试数据格式说明*** <br/>
客户端使用60个连接同时给gorm发送请求 <br/>
GORM每个工作线程和MySQL建立50个连接(100个连接测试下来和50个差别不大) <br/>
mysql列为mysql的CPU利用率 <br/>
gorm列为gorm的CPU利用率 <br/>
qps为每秒处理请求数 <br/>
请求耗时为平均一个请求的耗时(可以等同于mysql处理请求耗时) <br/>

### (1)、GET请求(表中185个字段全部拉取)
|			|1工作线程	|2工作线程	|3工作线程	|4工作线程	|5工作线程	|
|mysql消耗	|380%		|700%		|900%		|1150%		|1400%		|
|gorm消耗	|120%		|230%		|340%		|440%		|520%		|
|QPS		|5000		|9500		|13000		|16000		|17000-		|
|每请求耗时	|6+			|5.5+		|5.5+		|4+			|4			|

***一个工作线程:***
mysql:380% gorm:120%,qps:5000,		请求耗时:6+毫秒,最大耗时:27

****两个工作线程:****
mysql:703%,gorm:230%,qps:9500+,		请求耗时:5.5+,最大耗时:29

***三个工作线程:***
mysql:900%,gorm:340%,qps:13000,		请求耗时:5.5+,最大耗时:30,少部分达到70+

***四个工作线程:***
mysql:1150%,gorm:440%,qps:16000,	请求耗时:4+,最大耗时:30,少部分30以上

***五个工作线程:***
mysql:1400%,gorm:520%,qps:17000-,	请求耗时:4,最大耗时:30,少部分30以上

### (2)、UPDATE测试
> ***更新其中一个整形字段***
||1工作线程	|1工作线程	|2工作线程	|3工作线程	|4工作线程	|
|mysql消耗	|260%		|500%		|650%		|720%		|
|gorm消耗	|160%		|290%		|390%		|470%		|
|QPS		|16000		|30000		|36000		|41000		|
|每请求耗时	|3+			|2			|1			|0.5+		|

***一个工作线程:***
mysql:260%,gorm:160%,qps:16000,		请求耗时:3+,最大耗时:30
连接数从50改为100，qps可达19000

***两个工作线程:***
mysql:500%,gorm:290%,qps:30713,		请求耗时:2,最大耗时:18
连接数从50改成100，qps可达34000

***三个工作线程:***
mysql:650%,gorm:390%,qps:36000		请求耗时:1,最大耗时:9

***四个工作线程:***
mysql:720%,gorm:470%,qps:41000		请求耗时:0.5,最大耗时:9

***五个工作线程:***
和4个工作线程数据相似

.更新其中一个字符串字段，数据和更新一个整形字段相差不大


> ***.更新其中10个字段(由于数据比较少，全部缓存在内存中，结果和更新1个字段相似)***
***一个工作线程:***
mysql:320%,gorm:160%,qps:17505	

***两个工作线程:***
mysql:560,gorm:290,qps:28248

***三个工作线程:***
mysql:660%,gorm:380%,qps:33000


grep 1600772909 log.txt | grep duration > tmp.log 
awk '{print $3}' tmp.log  | awk -F ":" '{sum += $2};END {print sum}'
awk '{print $3}' tmp.log  | awk -F ":" '{print $2}' | sort -n